{"version":3,"sources":["BottomSheet.tsx"],"names":["BottomSheet","props","ref","height","colorScheme","onRequestClose","backdropClosesSheet","backdropBackgroundColor","sheetBackgroundColor","sheetStyle","draggable","showDragIcon","dragIconColor","dragIconStyle","borderRadius","contentContainerStyle","onOpenStart","onOpenFinish","onCloseStart","onCloseFinish","openTime","closeTime","children","isDraggable","Platform","OS","colorSchemeName","isDarkMode","visible","setVisible","animatedHeight","Animated","Value","pan","ValueXY","setModalVisibility","newVisible","timing","toValue","duration","useNativeDriver","start","setValue","x","y","panResponder","PanResponder","create","onStartShouldSetPanResponder","onPanResponderMove","e","gestureState","dy","event","onPanResponderRelease","_e","gestureLimitArea","gestureDistance","spring","current","show","hide","styles","wrapper","backgroundColor","minHeight","backdrop","panHandlers","transform","getTranslateTransform","container","borderTopRightRadius","borderTopLeftRadius","draggableContainer","draggableIcon"],"mappings":"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","sourcesContent":["import React, { memo, useMemo, useState, useRef, useImperativeHandle, useCallback, forwardRef, ReactNode, useEffect } from 'react';\nimport { Platform, View, Modal, TouchableOpacity, Animated, PanResponder, ViewStyle, useColorScheme } from 'react-native';\nimport { styles } from './styles';\n\nexport interface BottomSheetRef {\n  show: () => void;\n  hide: () => void;\n}\n\nexport interface BottomSheetProps {\n  children: ReactNode;\n  height: number;\n  colorScheme?: 'auto' | 'light' | 'dark' | undefined;\n  onRequestClose?: (() => void) | undefined;\n  backdropClosesSheet?: boolean | undefined;\n  backdropBackgroundColor?: string | undefined;\n  sheetBackgroundColor?: string | undefined;\n  sheetStyle?: ViewStyle | undefined;\n  draggable?: boolean | undefined;\n  showDragIcon?: boolean | undefined;\n  dragIconColor?: string | undefined;\n  dragIconStyle?: ViewStyle | undefined;\n  contentContainerStyle?: ViewStyle | undefined;\n  borderRadius?: number | undefined;\n  openTime?: number | undefined;\n  closeTime?: number | undefined;\n  onOpenStart?: () => void;\n  onOpenFinish?: () => void;\n  onCloseStart?: () => void;\n  onCloseFinish?: () => void;\n}\n\nexport const BottomSheet = memo(\n  forwardRef<BottomSheetRef, BottomSheetProps>((props, ref) => {\n    const {\n      height,\n      colorScheme,\n      onRequestClose,\n      backdropClosesSheet = true,\n      backdropBackgroundColor,\n      sheetBackgroundColor,\n      sheetStyle,\n      draggable = true,\n      showDragIcon = true,\n      dragIconColor,\n      dragIconStyle,\n      borderRadius = 10,\n      contentContainerStyle,\n      onOpenStart,\n      onOpenFinish,\n      onCloseStart,\n      onCloseFinish,\n      openTime = 300,\n      closeTime = 300,\n      children\n    } = props;\n\n    const isDraggable = Platform.OS !== 'web' && !!draggable;\n    const colorSchemeName = useColorScheme() || 'light';\n    const isDarkMode = useMemo(() => {\n      // Color Scheme from props passed as 'auto' or undefined\n      if (colorScheme === 'auto' || !colorScheme) {\n        // Then use OS hook result\n        return colorSchemeName === 'dark';\n      }\n      // Otherwise return user choice\n      return colorScheme === 'dark';\n    }, [colorScheme, colorSchemeName]);\n    const [visible, setVisible] = useState(false);\n    const animatedHeight = useMemo(() => new Animated.Value(0), []);\n    const pan = useMemo(() => new Animated.ValueXY(), []);\n\n    const setModalVisibility = useCallback(\n      (newVisible: boolean) => {\n        // Open modal\n        if (newVisible) {\n          setVisible(true);\n          if (typeof onOpenStart === 'function') onOpenStart();\n          Animated.timing(animatedHeight, {\n            toValue: height,\n            duration: openTime,\n            useNativeDriver: false\n          }).start(() => {\n            if (typeof onOpenFinish === 'function') onOpenFinish();\n          });\n          return;\n        }\n\n        // Close modal\n        if (typeof onCloseStart === 'function') onCloseStart();\n        Animated.timing(animatedHeight, {\n          toValue: 0,\n          duration: closeTime,\n          useNativeDriver: false\n        }).start(() => {\n          pan.setValue({ x: 0, y: 0 });\n          setVisible(false);\n          if (typeof onCloseFinish === 'function') onCloseFinish();\n        });\n      },\n      [animatedHeight, closeTime, height, onCloseFinish, onCloseStart, onOpenFinish, onOpenStart, openTime, pan]\n    );\n\n    // Respond to pan changes\n    const panResponder = useRef(\n      PanResponder.create({\n        onStartShouldSetPanResponder: () => true,\n        onPanResponderMove: (e, gestureState) => {\n          if (gestureState.dy > 0) {\n            Animated.event([null, { dy: pan.y }], {\n              useNativeDriver: false\n            })(e, gestureState);\n          }\n        },\n        onPanResponderRelease: (_e, gestureState) => {\n          const gestureLimitArea = height / 3;\n          const gestureDistance = gestureState.dy;\n          if (gestureDistance > gestureLimitArea) {\n            setModalVisibility(false);\n          } else {\n            Animated.spring(pan, {\n              toValue: { x: 0, y: 0 },\n              useNativeDriver: false\n            }).start();\n          }\n        }\n      })\n    ).current;\n\n    // If `height` prop changes while open, respond and change to new height immediately\n    useEffect(() => {\n      if (visible) {\n        Animated.timing(animatedHeight, {\n          toValue: height,\n          duration: 0,\n          useNativeDriver: false\n        }).start();\n      }\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [height]); // we only want the useEffect to run when height prop changes\n\n    // Expose specific methods on hook\n    useImperativeHandle(ref, () => ({\n      show: () => setModalVisibility(true),\n      hide: () => setModalVisibility(false)\n    }));\n\n    // Return nothing if not visible\n    if (!visible) return null;\n\n    return (\n      <Modal transparent visible={visible} onRequestClose={onRequestClose ? onRequestClose : () => setModalVisibility(false)}>\n        <View\n          style={[\n            styles.wrapper,\n            {\n              backgroundColor: backdropBackgroundColor || `#25252599`,\n              minHeight: height\n            }\n          ]}\n        >\n          <TouchableOpacity testID='backdrop' disabled={!backdropClosesSheet} style={styles.backdrop} activeOpacity={1} onPress={() => setModalVisibility(false)} />\n          <Animated.View\n            {...(isDraggable && panResponder.panHandlers)}\n            style={[\n              {\n                transform: pan.getTranslateTransform()\n              },\n              styles.container,\n              {\n                height: animatedHeight,\n                borderTopRightRadius: borderRadius,\n                borderTopLeftRadius: borderRadius,\n                backgroundColor: sheetBackgroundColor || isDarkMode ? '#222222' : '#F3F3F3'\n              },\n              sheetStyle\n            ]}\n            testID='animated-view'\n          >\n            {isDraggable && showDragIcon && (\n              <View style={styles.draggableContainer}>\n                <View\n                  testID='drag-icon'\n                  style={[\n                    styles.draggableIcon,\n                    dragIconStyle,\n                    {\n                      backgroundColor: dragIconColor || isDarkMode ? '#444444' : '#A3A3A3'\n                    }\n                  ]}\n                />\n              </View>\n            )}\n            <View style={[{ height }, contentContainerStyle]}>{children}</View>\n          </Animated.View>\n        </View>\n      </Modal>\n    );\n  })\n);\n"]}